import{a as Y}from"./chunk-EMU2OSP3.js";import{a as v}from"./chunk-5BRKJRO7.js";import{a as H}from"./chunk-7ADLUVNN.js";import{b as k}from"./chunk-RPSJVO6N.js";import{b as V,g as j}from"./chunk-PHUZ62ZG.js";import"./chunk-A7ZF5WII.js";import{a as P}from"./chunk-JXYCAX6H.js";import"./chunk-YW5HVEMI.js";import{a as Z}from"./chunk-3UMSFUQ2.js";import{c as J,d as K,e as Q,f as W,g as X}from"./chunk-2VMXUIEA.js";import"./chunk-6G7QZKZV.js";import{i as R}from"./chunk-RGSK6UMV.js";import"./chunk-RF2E4EZS.js";import{a as w,c as y}from"./chunk-S5T3GM4L.js";import{a as z}from"./chunk-ZWL73D3D.js";import{c as A}from"./chunk-UAARD3MB.js";import{f as I,h as _,j as E,k as F,o as D,q as N,s as U,x as T,y as O}from"./chunk-SHAAQNJE.js";import"./chunk-MYLRT4VQ.js";import{Ba as B,Ca as L,Db as p,Fb as f,Ia as S,Kb as c,Pb as t,Qb as i,Rb as h,Vb as G,_b as g,ac as u,ib as a,jb as d,mc as r,nc as C,ra as b,ub as q,yc as M}from"./chunk-XM6RWNSX.js";function re(e,n){e&1&&(t(0,"mat-error"),r(1,"required"),i())}function ae(e,n){e&1&&(t(0,"mat-error"),r(1,"at least 8 characters"),i())}var $=(()=>{let n=class n{constructor(m,o,s){this.profileService=m,this.formBuilder=o,this.destroyRef=s,this.passwordForm=this.formBuilder.group({password:this.formBuilder.control("",[_.required,_.minLength(8),_.maxLength(255)])})}get shortPassword(){return this.passwordForm.controls.password.errors?.minlength}get emptyPassword(){return this.passwordForm.controls.password.errors?.required}onSubmit(){this.passwordForm.valid&&this.profileService.updateUserPassword(this.passwordForm.getRawValue()).pipe(v(this.destroyRef)).subscribe()}};n.\u0275fac=function(o){return new(o||n)(d(R),d(T),d(S))},n.\u0275cmp=b({type:n,selectors:[["app-change-password-form"]],standalone:!0,features:[M],decls:18,vars:4,consts:[[1,"dialog-header"],["mat-dialog-title",""],["mat-mini-fab","","mat-dialog-close",""],[3,"ngSubmit","formGroup"],[1,"label"],["appearance","outline",1,"full-width"],["type","password","matInput","","formControlName","password",1,"full-width"],["type","submit","mat-flat-button","","mat-dialog-close","",1,"btn",3,"disabled"]],template:function(o,s){o&1&&(t(0,"div",0)(1,"div",1),r(2,"Change password"),i(),t(3,"mat-dialog-actions")(4,"button",2)(5,"mat-icon"),r(6,"close"),i()()()(),t(7,"mat-dialog-content")(8,"form",3),g("ngSubmit",function(){return s.onSubmit()}),t(9,"div",4),r(10,"New password"),i(),t(11,"mat-form-field",5),h(12,"input",6),p(13,re,2,0,"mat-error")(14,ae,2,0,"mat-error"),i(),t(15,"mat-dialog-actions")(16,"button",7),r(17," Save "),i()()()()),o&2&&(a(8),f("formGroup",s.passwordForm),a(5),c(s.emptyPassword?13:-1),a(),c(s.shortPassword?14:-1),a(2),f("disabled",s.passwordForm.invalid))},dependencies:[O,D,I,E,F,N,U,w,P,X,Q,W,j,k,K,y,V],styles:[".dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.btn[_ngcontent-%COMP%]{width:100%;border-radius:4px}.label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:10px}.full-width[_ngcontent-%COMP%]{width:100%}"],changeDetection:0});let e=n;return e})();function le(e,n){e&1&&h(0,"mat-progress-spinner",6)}function me(e,n){if(e&1&&(t(0,"div"),r(1),i()),e&2){let l=u(2);a(),C(l.userInformationForm.value.name)}}function se(e,n){e&1&&(t(0,"mat-error"),r(1,"required"),i())}function de(e,n){if(e&1&&(t(0,"div")(1,"mat-form-field",12),h(2,"input",13),p(3,se,2,0,"mat-error"),i()()),e&2){let l=u(2);a(3),c(l.invalidName?3:-1)}}function ce(e,n){if(e&1&&(t(0,"div"),r(1),i()),e&2){let l=u(2);a(),C(l.userInformationForm.value.email)}}function pe(e,n){e&1&&(t(0,"mat-error"),r(1,"required"),i())}function ue(e,n){e&1&&(t(0,"mat-error"),r(1,"invalid email"),i())}function fe(e,n){if(e&1&&(t(0,"div")(1,"mat-form-field",12),h(2,"input",14),p(3,pe,2,0,"mat-error")(4,ue,2,0,"mat-error"),i()()),e&2){let l=u(2);a(3),c(l.emptyEmail?3:-1),a(),c(l.invalidEmail?4:-1)}}function ge(e,n){if(e&1){let l=G();t(0,"div",8)(1,"div",9),r(2,"Name"),i(),t(3,"div",10),p(4,me,2,1,"div")(5,de,4,1,"div"),t(6,"button",11),g("click",function(){B(l);let o=u();return L(o.editMode().name?o.onSubmit():o.toggleEditMode("name"))}),t(7,"mat-icon"),r(8),i()()()(),t(9,"div",8)(10,"div",9),r(11,"Email"),i(),t(12,"div",10),p(13,ce,2,1,"div")(14,fe,5,2,"div"),t(15,"button",11),g("click",function(){B(l);let o=u();return L(o.editMode().email?o.onSubmit():o.toggleEditMode("email"))}),t(16,"mat-icon"),r(17),i()()()()}if(e&2){let l=u();a(4),c(l.editMode().name?5:4),a(2),f("disabled",l.invalidName),a(2),C(l.editMode().name?"save":"edit"),a(5),c(l.editMode().email?14:13),a(2),f("disabled",l.invalidEmail||l.emptyEmail),a(2),C(l.editMode().email?"save":"edit")}}var Be=(()=>{let n=class n{constructor(m,o,s,x,ee,te){this.router=m,this.profileService=o,this.authService=s,this.formBuilder=x,this.matDialog=ee,this.destroyRef=te,this.loading=q(!1),this.userInformationForm=this.formBuilder.group({email:this.formBuilder.control("",[_.required,Y()]),name:this.formBuilder.control("",[_.required])}),this.editMode=q({email:!1,name:!1}),this.userRole=this.profileService.userRole}ngOnInit(){this.getUserInformation()}get invalidEmail(){return this.userInformationForm.controls.email.errors?.invalidEmail}get emptyEmail(){return this.userInformationForm.controls.email.errors?.required}get invalidName(){return this.userInformationForm.controls.name.errors?.required}toggleEditMode(m){this.editMode()[m]=!this.editMode()[m]}onSubmit(){this.editMode.set({email:!1,name:!1}),this.updateUserInformation()}logout(){this.authService.logout(),this.profileService.userRole.set("user"),this.router.navigate([z.Search])}openDialog(){this.matDialog.open($)}getUserInformation(){this.setLoading(!0),this.profileService.getUserInformation().pipe(v(this.destroyRef)).subscribe({next:m=>{this.userInformationForm.setValue({name:m.name??"Name Surname",email:m.email})},error:()=>{this.setLoading(!1)},complete:()=>{this.setLoading(!1)}})}updateUserInformation(){this.setLoading(!0);let m=this.userInformationForm.getRawValue();this.profileService.updateUserInformation(m).pipe(v(this.destroyRef)).subscribe({error:()=>{this.setLoading(!1)},complete:()=>{this.setLoading(!1)}})}setLoading(m){this.loading.set(m)}};n.\u0275fac=function(o){return new(o||n)(d(A),d(R),d(H),d(T),d(J),d(S))},n.\u0275cmp=b({type:n,selectors:[["app-user-profile"]],standalone:!0,features:[M],decls:13,vars:3,consts:[[1,"layout"],[1,"title"],[1,"role-and-button"],[1,"role"],["mat-flat-button","",1,"btn",3,"click"],[1,"form",3,"formGroup"],["mode","indeterminate",1,"spinner"],["mat-flat-button","","color","warn",1,"btn","btn-logout",3,"click"],[1,"control"],[1,"label"],[1,"input-and-buton"],["mat-mini-fab","",3,"click","disabled"],["appearance","outline","subscriptSizing","dynamic",1,"full-width"],["type","text","matInput","","formControlName","name"],["type","email","matInput","","formControlName","email"]],template:function(o,s){o&1&&(t(0,"div",0)(1,"h4",1),r(2,"Profile"),i(),t(3,"div",2)(4,"div",3),r(5),i(),t(6,"button",4),g("click",function(){return s.openDialog()}),r(7,"Change Password"),i()(),t(8,"form",5),p(9,le,1,0,"mat-progress-spinner",6)(10,ge,18,6),i(),t(11,"button",7),g("click",function(){return s.logout()}),r(12,"Logout"),i()()),o&2&&(a(5),C(s.userRole()==="manager"?"manager":""),a(3),f("formGroup",s.userInformationForm),a(),c(s.loading()?9:10))},dependencies:[O,D,I,E,F,N,U,P,y,j,k,Z,w,V],styles:[".layout[_ngcontent-%COMP%]{display:grid;gap:30px;width:450px;margin:40px auto;padding:20px;background-color:#f2f2f2;border-radius:12px}.layout[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{text-align:center;font-weight:900}.role-and-button[_ngcontent-%COMP%]{justify-self:end;text-align:right}.role[_ngcontent-%COMP%]{text-transform:capitalize;padding-right:10px}.btn[_ngcontent-%COMP%]{border-radius:4px}.btn-logout[_ngcontent-%COMP%]{justify-self:start}.form[_ngcontent-%COMP%]{display:grid;gap:10px}.spinner[_ngcontent-%COMP%]{justify-self:center}.label[_ngcontent-%COMP%]{font-weight:700}.input-and-buton[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:20px;align-items:center}.full-width[_ngcontent-%COMP%], .ng-star-inserted[_ngcontent-%COMP%]{width:100%}"],changeDetection:0});let e=n;return e})();export{Be as UserProfileComponent};
