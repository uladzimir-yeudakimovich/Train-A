import{a as It}from"./chunk-CHX7256A.js";import{a as lt,b as ct}from"./chunk-HJ3J5ODY.js";import{a as Tt,b as Lt,g as Vt}from"./chunk-PHUZ62ZG.js";import{a as N}from"./chunk-JXYCAX6H.js";import"./chunk-YW5HVEMI.js";import{a as Dt}from"./chunk-6RZP75QW.js";import{a as E}from"./chunk-XU3SDQ4H.js";import{a as k}from"./chunk-3UMSFUQ2.js";import{c as kt}from"./chunk-2VMXUIEA.js";import{c as U}from"./chunk-RF2E4EZS.js";import{$ as Rt,C as xt,F as St,G as Mt,I as bt,R as j,S as vt,T as V,U as Ft,W as yt,Y as Pt,Z as Ot,a as w,aa as wt,ca as Et,d as st,g as A}from"./chunk-S5T3GM4L.js";import{a as nt,c as rt}from"./chunk-UAARD3MB.js";import{h as J,j as mt,k as pt,o as ut,q as dt,r as _t,s as ft,v as gt,w as Ct,y as ht}from"./chunk-SHAAQNJE.js";import{qa as at}from"./chunk-MYLRT4VQ.js";import{Ba as u,Bc as G,Ca as d,Cc as W,Db as _,Fb as p,Kb as C,Lb as I,Mb as tt,Na as Z,Nb as P,Oa as R,Ob as O,Pb as r,Qb as a,Rb as x,Vb as h,Vc as it,_b as f,a as Q,ac as c,b as X,ib as s,jb as y,ma as g,mc as m,nc as b,oc as B,ra as S,ua as Y,ub as M,uc as $,vc as et,wc as ot,yc as v}from"./chunk-XM6RWNSX.js";var T={entity:void 0,collection:"routes",selectId:t=>t.id};var L=Ft({providedIn:"root"},Et(T),yt((t,i=g(vt))=>({async getRoutes(){if(!t.routesIds().length){let e=await i.loadRoutes();V(t,Rt(e,T))}},async postRoute(e){let n=await i.postRoute(e);if("id"in n){let o=Number(n.id),l=X(Q({},e),{id:o});V(t,Pt(l,T))}},async updateRoute(e,n){await i.updateRoute(e,n),V(t,wt({id:e,changes:n},T))},async deleteRoute(e){await i.deleteRoute(e),V(t,Ot(e,T))}})));var Bt=3,$t=3,Nt=512,At=512;function H(t){let i=t+1;return e=>e instanceof gt?e.length>=i?null:{minArrayLength:{requiredLength:i,actualLength:e.length}}:null}var Jt=(t,i)=>i.value,Ht=(t,i)=>i.id;function Kt(t,i){t&1&&(r(0,"div",0),x(1,"mat-spinner",2),r(2,"div",3),m(3,"Saving changes..."),a()())}function Qt(t,i){if(t&1&&(r(0,"mat-option",15),m(1),a()),t&2){let e=i.$implicit;p("value",e.id),s(),b(e.city)}}function Xt(t,i){if(t&1){let e=h();r(0,"button",17),f("click",function(o){u(e);let l=c().$index,F=c(2);return d(F.onDeleteStation(o,l))}),r(1,"mat-icon"),m(2,"delete"),a()()}}function Yt(t,i){if(t&1){let e=h();r(0,"div",7)(1,"mat-form-field",13),f("click",function(){let o=u(e).$index,l=c(2);return d(l.onStationClick(o))}),r(2,"mat-label"),m(3,"Station"),a(),$(4),r(5,"mat-select",14),f("selectionChange",function(){let o=u(e).$index,l=c(2);return d(l.onSetStation(o))}),P(6,Qt,2,2,"mat-option",15,Ht),a()(),$(8)(9),_(10,Xt,3,0,"button",16),a()}if(t&2){let e=i.$index;c();let n=ot(3),o=c(),l=e>0?o.stations.controls[e-1].value:null;s(5),p("formControlName",e),s(),O(n(l));let F=e===0&&o.stations.controls.length>1,z=e===o.stations.controls.length-2;s(4),C(F||z?10:-1)}}function Zt(t,i){if(t&1&&(r(0,"mat-error"),m(1),a()),t&2){let e=c(2);s(),b(e.getStationsErrorMessage())}}function te(t,i){if(t&1&&(r(0,"mat-option",15),m(1),a()),t&2){let e=i.$implicit;p("value",e.code),s(),b(e.name)}}function ee(t,i){if(t&1){let e=h();r(0,"button",17),f("click",function(o){u(e);let l=c().$index,F=c(2);return d(F.onDeleteCarriage(o,l))}),r(1,"mat-icon"),m(2,"delete"),a()()}}function oe(t,i){if(t&1){let e=h();r(0,"div",7)(1,"mat-form-field",18)(2,"mat-label"),m(3,"Carriage"),a(),r(4,"mat-select",14),f("selectionChange",function(){let o=u(e).$index,l=c(2);return d(l.onSetCarriage(o))}),P(5,te,2,2,"mat-option",15,I),a()(),_(7,ee,3,0,"button",16),a()}if(t&2){let e=i.$index,n=i.$count,o=c(2);s(4),p("formControlName",e),s(),O(o.carriageOptions()),s(2),C(e!==n-1?7:-1)}}function ie(t,i){if(t&1&&(r(0,"mat-error"),m(1),a()),t&2){let e=c(2);s(),b(e.getCarriagesErrorMessage())}}function ne(t,i){if(t&1){let e=h();r(0,"form",4),f("ngSubmit",function(){u(e);let o=c();return d(o.onSubmit())}),r(1,"div",5)(2,"div",6),$(3),P(4,Yt,11,2,"div",7,Jt),_(6,Zt,2,1,"mat-error"),a(),r(7,"div",8),P(8,oe,8,2,"div",7,tt),_(10,ie,2,1,"mat-error"),a()(),r(11,"div",9)(12,"button",10),f("click",function(){u(e);let o=c();return d(o.onClose())}),m(13," Cancel "),a(),r(14,"button",11),f("click",function(){u(e);let o=c();return d(o.onReset())}),m(15," Reset "),a(),r(16,"button",12),m(17," Submit "),a()()()}if(t&2){let e=c();p("formGroup",e.routeForm),s(3),et(e.connectedStationsMap()),s(),O(e.stations.controls),s(2),C(e.stations.invalid&&e.stations.touched?6:-1),s(2),O(e.carriages.controls),s(2),C(e.carriages.invalid&&e.carriages.touched?10:-1),s(6),p("disabled",e.isSaveDisabled())}}var D=(()=>{let i=class i{constructor(n,o){this.formBuilder=n,this.snackBarService=o,this.route=R(),this.closeForm=Z(),this.isLoading=M(!1),this.carriageStore=g(U),this.stationStore=g(E),this.routeStore=g(L)}ngOnInit(){this.connectedStationsMap=this.stationStore.getConnectedStations,this.carriageOptions=this.carriageStore.carriagesEntities,this.routeForm=this.formBuilder.group({stations:this.formBuilder.array([],[H(Bt),J.maxLength(Nt)]),carriages:this.formBuilder.array([],[H($t),J.maxLength(At)])}),this.initRouteForm()}onSubmit(){this.stations.enable();let n=!!this.route(),o=this.getFormRoute();if(this.isLoading.set(!0),n){this.routeStore.updateRoute(this.route().id,o).then(()=>{this.onClose()}).catch(l=>{this.snackBarService.displayError(l)}).finally(()=>{this.isLoading.set(!1)});return}this.routeStore.postRoute(o).then(()=>{this.onReset()}).catch(l=>{this.snackBarService.displayError(l)}).finally(()=>{this.isLoading.set(!1)})}onReset(){this.routeForm.reset(),this.stations.clear(),this.carriages.clear(),this.initRouteForm(),this.enableLastTwoStations()}onClose(){this.closeForm.emit(!0)}onSetStation(n){let o=this.stations.length-1;n===o&&(this.addStationControl(),this.enableLastTwoStations())}onSetCarriage(n){let o=this.carriages.length-1;n===o&&this.addCarriageControl()}onDeleteStation(n,o){n.stopPropagation(),this.stations.removeAt(o),this.enableLastTwoStations(),this.routeForm.markAsDirty()}onDeleteCarriage(n,o){n.stopPropagation(),this.carriages.removeAt(o),this.routeForm.markAsDirty()}onStationClick(n){this.stations.at(n).disabled&&this.snackBarService.open(A.RoutFormCannotChangeStation)}getStationsErrorMessage(){return this.stations.hasError("minArrayLength")?"At least 3 stations are required":""}getCarriagesErrorMessage(){return this.carriages.hasError("minArrayLength")?"At least 3 carriages are required":""}isSaveDisabled(){return!this.routeForm.valid||this.routeForm.pristine}get stations(){return this.routeForm.get("stations")}get carriages(){return this.routeForm.get("carriages")}getFormRoute(){return{path:this.stations.value.slice(0,-1).map(Number),carriages:this.carriages.value.slice(0,-1)}}initRouteForm(){let n=this.route();n&&(n.path.forEach(o=>{this.stations.push(this.formBuilder.control(o))}),n.carriages.forEach(o=>{this.carriages.push(this.formBuilder.control(o))})),this.addCarriageControl(),this.addStationControl(),this.enableLastTwoStations()}enableLastTwoStations(){let n=this.stations.controls;if(n.length<2){this.stations.enable();return}this.stations.disable({emitEvent:!1,onlySelf:!0}),n[n.length-1].enable(),n[n.length-2].enable()}addCarriageControl(){this.carriages.push(this.formBuilder.control(null))}addStationControl(){this.stations.push(this.formBuilder.control(null))}};i.\u0275fac=function(o){return new(o||i)(y(Ct),y(j))},i.\u0275cmp=S({type:i,selectors:[["app-route-form"]],inputs:{route:[1,"route"]},outputs:{closeForm:"closeForm"},standalone:!0,features:[v],decls:2,vars:1,consts:[[1,"spinner-container"],[1,"form",3,"formGroup"],[1,"spinner"],[1,"label"],[1,"form",3,"ngSubmit","formGroup"],[1,"form-grid"],["formArrayName","stations",1,"col"],[1,"form-field-container"],["formArrayName","carriages",1,"col"],[1,"buttons"],["mat-flat-button","","type","button",1,"cancel-button",3,"click"],["mat-flat-button","","type","button",1,"reset-button",3,"click"],["mat-flat-button","","type","submit",3,"disabled"],[1,"form-field",3,"click"],[3,"selectionChange","formControlName"],[3,"value"],["mat-icon-button","","type","button",1,"delete-button"],["mat-icon-button","","type","button",1,"delete-button",3,"click"],[1,"form-field"]],template:function(o,l){o&1&&_(0,Kt,4,0,"div",0)(1,ne,18,5,"form",1),o&2&&C(l.isLoading()?0:1)},dependencies:[Vt,Tt,at,It,w,ht,ut,mt,pt,dt,ft,_t,N,st,Lt,k],styles:["[_nghost-%COMP%]   .cancel-button[_ngcontent-%COMP%]{background-color:#fad099}[_nghost-%COMP%]   .reset-button[_ngcontent-%COMP%]{background-color:#afafaf}[_nghost-%COMP%]   .form-grid[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .form-grid[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;flex-direction:column;margin:1rem;width:calc(50% - 2rem)}[_nghost-%COMP%]   .form-field-container[_ngcontent-%COMP%]{position:relative;padding-right:2rem}[_nghost-%COMP%]   .form-field-container[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .form-field-container[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{position:absolute;right:-1rem;top:.5rem}[_nghost-%COMP%]   .form-field-container[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{margin:0 auto;display:flex;justify-content:space-around;max-width:500px}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:25%}[_nghost-%COMP%]   .spinner-container[_ngcontent-%COMP%]{width:400px;height:200px;position:relative}[_nghost-%COMP%]   .spinner-container[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}[_nghost-%COMP%]   .spinner-container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{position:absolute;font-size:1.2rem;top:calc(50% - 6rem);left:50%;transform:translate(-50%)}"],changeDetection:0});let t=i;return t})();var K=(()=>{let i=class i{transform(n){return n.join("  \u2014  ")}};i.\u0275fac=function(o){return new(o||i)},i.\u0275pipe=Y({name:"joinWithDash",type:i,pure:!0,standalone:!0});let t=i;return t})();function se(t,i){t&1&&(r(0,"div",1),x(1,"mat-spinner",2),r(2,"div",3),m(3,"Deleting the route"),a()())}function le(t,i){if(t&1){let e=h();r(0,"button",9),f("click",function(){let o=u(e).$implicit;return d(o.click())}),r(1,"mat-icon",10),m(2),a(),r(3,"label",11),m(4),a()()}if(t&2){let e=i.$implicit;s(),p("id",e.icon),s(),b(e.icon),s(),p("for",e.icon),s(),b(e.label)}}function ce(t,i){if(t&1&&P(0,le,5,4,"button",8,I),t&2){let e=c(2);O(e.toolbarButtons)}}function me(t,i){if(t&1&&(r(0,"div",12)(1,"span"),m(2,"Cities:"),a(),r(3,"p",13),m(4),G(5,"joinWithDash"),a()(),r(6,"div",14)(7,"span"),m(8,"Carriage Types:"),a(),r(9,"p",15),m(10),G(11,"joinWithDash"),a()()),t&2){let e=c(2);s(4),B(" ",W(5,2,e.cities())," "),s(6),B(" ",W(11,4,e.route().carriages)," ")}}function pe(t,i){if(t&1){let e=h();r(0,"app-route-form",16),f("closeForm",function(){u(e);let o=c(2);return d(o.toggleUpdateForm())}),a()}if(t&2){let e=c(2);p("route",e.route())}}function ue(t,i){if(t&1&&(r(0,"mat-toolbar")(1,"mat-toolbar-row",4)(2,"span",5),m(3),a(),x(4,"span",6),_(5,ce,2,0),a()(),_(6,me,12,6)(7,pe,1,1,"app-route-form",7)),t&2){let e=c();s(3),B("Route ",e.route().id,""),s(2),C(e.displayUpdateForm()?-1:5),s(),C(e.displayUpdateForm()?7:6)}}var jt=(()=>{let i=class i{constructor(n,o,l){this.router=n,this.activatedRoute=o,this.snackBarService=l,this.route=R.required(),this.displayUpdateForm=M(!1),this.isLoading=M(!1),this.cities=it(()=>{let F=this.route().path;return this.stationStore.getStationsByIds()(F).map(z=>z?.city)}),this.dialog=g(kt),this.routeStore=g(L),this.stationStore=g(E)}openDialog(){this.dialog.open(Dt,{data:{title:`Delete Route ${this.route().id}`,message:A.RouteDeleteConfirmation}}).afterClosed().subscribe(o=>{o&&(this.isLoading.set(!0),this.routeStore.deleteRoute(this.route().id).catch(l=>{this.snackBarService.displayError(l)}).finally(()=>{this.isLoading.set(!1)}))})}onAssignRideClick(){let n=this.route().id;this.router.navigate([n],{relativeTo:this.activatedRoute})}toggleUpdateForm(){this.displayUpdateForm.update(n=>!n)}get toolbarButtons(){return[{label:"Update",icon:"edit_square",click:()=>this.toggleUpdateForm()},{label:"Assign ride",icon:"train",click:()=>this.onAssignRideClick()},{label:"",icon:"delete",click:()=>this.openDialog()}]}};i.\u0275fac=function(o){return new(o||i)(y(rt),y(nt),y(j))},i.\u0275cmp=S({type:i,selectors:[["app-route-card"]],inputs:{route:[1,"route"]},standalone:!0,features:[v],decls:3,vars:1,consts:[[1,"wrapper"],[1,"spinner-container"],[1,"spinner"],[1,"label"],[1,"toolbar"],[1,"route-name"],[1,"toolbar-spacer"],[3,"route"],["mat-raised-button","",1,"toolbar-button"],["mat-raised-button","",1,"toolbar-button",3,"click"],["aria-hidden","false",3,"id"],[3,"for"],[1,"cities"],[1,"cities-list"],[1,"carriages"],[1,"carriages-list"],[3,"closeForm","route"]],template:function(o,l){o&1&&(r(0,"div",0),_(1,se,4,0,"div",1)(2,ue,8,3),a()),o&2&&(s(),C(l.isLoading()?1:2))},dependencies:[N,lt,ct,w,K,D,k],styles:["[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]{width:100%;height:100%;padding:1rem 2rem;border-radius:1rem;box-shadow:0 0 .5rem #0000004d}[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{background-color:#fff;padding:0}[_nghost-%COMP%]   .route-name[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .toolbar-button[_ngcontent-%COMP%]{margin:0 1rem}[_nghost-%COMP%]   .toolbar-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}[_nghost-%COMP%]   .cities-list[_ngcontent-%COMP%], [_nghost-%COMP%]   .carriages-list[_ngcontent-%COMP%]{margin-left:1rem}[_nghost-%COMP%]   .spinner-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100%;position:fixed;top:0;left:0;position:relative}[_nghost-%COMP%]   .spinner-container[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}[_nghost-%COMP%]   .spinner-container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{position:absolute;font-size:1.2rem;top:calc(50% - 6rem);left:50%;transform:translate(-50%)}"],changeDetection:0});let t=i;return t})();function de(t,i){if(t&1&&(r(0,"div",3),x(1,"app-route-card",4),a()),t&2){let e=i.$implicit;s(),p("route",e)}}var Ut=(()=>{let i=class i{constructor(){this.routes=R.required()}};i.\u0275fac=function(o){return new(o||i)},i.\u0275cmp=S({type:i,selectors:[["app-route-list"]],inputs:{routes:[1,"routes"]},standalone:!0,features:[v],decls:3,vars:1,consts:[["appendOnly","","itemSize","10",1,"viewport"],[1,"list"],["class","list-item",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"list-item"],[3,"route"]],template:function(o,l){o&1&&(r(0,"cdk-virtual-scroll-viewport",0)(1,"div",1),_(2,de,2,1,"div",2),a()()),o&2&&(s(2),p("cdkVirtualForOf",l.routes()))},dependencies:[jt,bt,xt,Mt,St],styles:["[_nghost-%COMP%]{display:block;width:100%}[_nghost-%COMP%]   .viewport[_ngcontent-%COMP%]{height:100vh;width:100%;display:flex;flex-direction:row}[_nghost-%COMP%]   .list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-around}[_nghost-%COMP%]   .list-item[_ngcontent-%COMP%]{margin:2rem 0;width:80%}@media (min-width: 1200px){[_nghost-%COMP%]   .list-item[_ngcontent-%COMP%]{width:calc(45% - 5rem)}}"],changeDetection:0});let t=i;return t})();function _e(t,i){t&1&&(r(0,"div",0),x(1,"mat-spinner",1),r(2,"div",2),m(3,"Loading the routes"),a()())}function fe(t,i){if(t&1){let e=h();r(0,"button",6),f("click",function(){u(e);let o=c(2);return d(o.toggleRouteForm())}),m(1," Create new route "),a()}}function ge(t,i){if(t&1){let e=h();r(0,"app-route-form",7),f("closeForm",function(){u(e);let o=c(2);return d(o.toggleRouteForm())}),a()}}function Ce(t,i){if(t&1&&(r(0,"div",3),_(1,fe,2,0,"button",4)(2,ge,1,0,"app-route-form"),a(),x(3,"app-route-list",5)),t&2){let e=c();s(),C(e.displayCreateRouteForm()?2:1),s(2),p("routes",e.routes())}}var Fo=(()=>{let i=class i{constructor(){this.displayCreateRouteForm=M(!1),this.isLoading=M(!0),this.routeStore=g(L),this.stationStore=g(E),this.carriageStore=g(U)}ngOnInit(){Promise.all([this.carriageStore.getCarriages(),this.stationStore.getStations(),this.routeStore.getRoutes()]).then(()=>{this.isLoading.set(!1)}),this.routes=this.routeStore.routesEntities}toggleRouteForm(){this.displayCreateRouteForm.update(n=>!n)}};i.\u0275fac=function(o){return new(o||i)},i.\u0275cmp=S({type:i,selectors:[["app-routes"]],standalone:!0,features:[v],decls:2,vars:1,consts:[[1,"spinner-container"],[1,"spinner"],[1,"label"],[1,"route-form"],["mat-flat-button","",1,"button-center"],[3,"routes"],["mat-flat-button","",1,"button-center",3,"click"],[3,"closeForm"]],template:function(o,l){o&1&&_(0,_e,4,0,"div",0)(1,Ce,4,2),o&2&&C(l.isLoading()?0:1)},dependencies:[Ut,w,D,k],styles:["[_nghost-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;width:85%;margin:0 auto}[_nghost-%COMP%]   .route-form[_ngcontent-%COMP%]{margin-top:1rem}[_nghost-%COMP%]   .route-form[_ngcontent-%COMP%]   .button-center[_ngcontent-%COMP%]{margin:0 auto}[_nghost-%COMP%]   .spinner-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;height:100%;position:fixed;top:0;left:0}[_nghost-%COMP%]   .spinner-container[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}[_nghost-%COMP%]   .spinner-container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{position:absolute;font-size:1.5rem;top:calc(50% - 6rem);left:50%;transform:translate(-50%)}"],changeDetection:0});let t=i;return t})();export{Fo as RoutesComponent};
