import{$ as S,Q as E,R as A,S as p,T as I,V as C,X as x,_ as j,ba as M,f as h}from"./chunk-EVOHVUKJ.js";import{x as v}from"./chunk-YQJCNX7A.js";import{Tc as y,a as l,b as f,ea as w,ja as b,ka as d,v as u}from"./chunk-MTQVXK5S.js";var c=function(e){return e.Reserved="reserved",e.Available="available",e.Selected="selected",e}(c||{});var R=(()=>{let a=class a{constructor(t){this.http=t}addCarriage(t){return u(this.http.post(h.Carriage,t)).catch(r=>{throw r})}updateCarriage(t){return u(this.http.put(`${h.Carriage}/${t.code}`,t)).catch(r=>{throw r})}};a.\u0275fac=function(r){return new(r||a)(b(v))},a.\u0275prov=w({token:a,factory:a.\u0275fac,providedIn:"root"});let e=a;return e})();function g(e,a){let o=[],t=e.leftSeats+e.rightSeats;for(let r=0;r<e.rows*t;r+=1){let i=r%e.rows,s=Math.floor(r/e.rows),n=(i+1)*t-s;o.push({number:n,state:a?.includes(n)?c.Reserved:c.Available})}return o}var m={entity:void 0,collection:"carriages",selectId:e=>e.code};var Y=I({providedIn:"root"},M(m),C((e,a=d(A))=>({getCarriage:o=>e.carriagesEntityMap()[o]??null,async getCarriages(){if(!e.carriagesIds().length){let o=(await a.loadCarriages()).map(t=>f(l({},t),{seats:g(t)}));p(e,j(o,m))}}})),C((e,a=d(R),o=d(E))=>({getCarriageSignal:t=>y(()=>e.getCarriage(t)),getSortedSeats:t=>[...e.getCarriage(t).seats].sort((i,s)=>i.number-s.number),getAvailableSeatsNumber:t=>e.getCarriage(t).seats.filter(i=>i.state!==c.Reserved).length,updateSeat:(t,r)=>{p(e,S({id:t.code,changes:i=>{let s=i.seats.find(n=>n.number===r.number);return s.state=r.state,i}},m))},async updateCarriage(t){await a.updateCarriage(t).then(r=>{if("code"in r){let i=f(l({},t),{seats:g(t)});p(e,S({id:t.code,changes:i},m))}}).catch(r=>o.displayError(r))},async addCarriage(t){await a.addCarriage(t).then(r=>{if("code"in r){let{code:i}=r,{name:s,leftSeats:n,rightSeats:F,rows:N}=t,$={code:i,name:s,leftSeats:n,rightSeats:F,rows:N,seats:g(t)};p(e,x($,m))}}).catch(r=>o.displayError(r))}})));export{c as a,g as b,Y as c};
