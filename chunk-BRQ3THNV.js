import{a as W}from"./chunk-E3YR2YRX.js";import{a as he}from"./chunk-TGXTDPWR.js";import{a as z}from"./chunk-QRW435WX.js";import{a as ve}from"./chunk-53VXDIFN.js";import{c as ge}from"./chunk-T4W7GD3U.js";import{R as _e,T as R,U as xe,W as fe,X as Ce,a as q,c as U,f as A}from"./chunk-7T747AWH.js";import{a as j}from"./chunk-ZWL73D3D.js";import{a as pe,c as me}from"./chunk-IE527E7W.js";import{y as ue}from"./chunk-JHSZ4YJF.js";import{k as ce,s as le}from"./chunk-Y6UWJUYI.js";import{Ba as u,Bc as Q,Ca as _,Db as v,Dc as X,Fb as h,K as P,Kb as b,Lb as S,Nb as y,Oa as L,Ob as T,Pb as a,Qb as d,Rb as O,Vb as f,Vc as V,_b as m,a as E,aa as ee,ac as c,b as k,ga as te,ib as l,jb as J,la as ie,lc as C,ma as x,mc as p,nc as $,oc as I,pc as K,ra as w,rc as re,sc as oe,t as Z,tc as ae,u as D,ub as N,uc as de,vc as se,wc as B,xb as ne,yc as F}from"./chunk-XM6RWNSX.js";var Ie=i=>i.map(n=>({time:{departure:{date:n.time[0].split("T")[0],time:n.time[0].split("T")[1].slice(0,5)},arrival:{date:n.time[1].split("T")[0],time:n.time[1].split("T")[1].slice(0,5)}},price:n.price})),Y=i=>i.map(n=>({time:[new Date(`${n.time.departure.date}T${n.time.departure.time}`).toISOString(),new Date(`${n.time.arrival.date}T${n.time.arrival.time}`).toISOString()],price:n.price})),be=i=>i.map(n=>({rideId:n.rideId,segments:Ie(n.segments)}));var Se=(()=>{let n=class n{constructor(t){this.http=t,this.stationsStore=x(z)}getRouteInformation(t){return this.http.get(`${A.Route}/${t}`).pipe(ee(e=>{let r=[...new Set(e.carriages)],s=this.stationsStore.getStationsByIds()(e.path).map(G=>G.city),g=be(e.schedule);return Z({routeId:e.id,carriages:r,stations:s,schedule:g})}),P(e=>D(()=>e)))}createRide(t,e){let r=Y(e);return this.http.post(`${A.Route}/${t}/ride`,{segments:r}).pipe(P(s=>D(()=>s)))}updateRide(t,e,r){let s=Y(r);return this.http.put(`${A.Route}/${t}/ride/${e}`,{segments:s}).pipe(P(g=>D(()=>g)))}deleteRide(t,e){return this.http.delete(`${A.Route}/${t}/ride/${e}`).pipe(P(r=>D(()=>r)))}};n.\u0275fac=function(e){return new(e||n)(ie(le))},n.\u0275prov=te({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();var Fe={routeId:0,carriages:[],stations:[],schedule:[],loading:!1},M=xe({providedIn:"root"},Ce(Fe),fe((i,n=x(Se),o=x(_e))=>({prepareStore(t){R(i,{loading:!0}),n.getRouteInformation(t).subscribe({next:e=>{R(i,{routeId:e.routeId,carriages:e.carriages,stations:e.stations,schedule:e.schedule})},error:e=>{o.displayError(e),R(i,{loading:!1})},complete:()=>{R(i,{loading:!1})}})},updateRide(t){let e=i.schedule().find(r=>r.rideId===t);e&&n.updateRide(i.routeId(),t,e.segments).subscribe({error:r=>{o.displayError(r)}})},createRide(t,e){R(i,{loading:!0}),n.createRide(t,e).subscribe({next(r){let s={rideId:r.id,segments:e};R(i,g=>k(E({},g),{schedule:[s,...g.schedule],loading:!1}))},error:r=>{o.displayError(r)},complete:()=>{R(i,{loading:!1})}})},deleteRide(t){n.deleteRide(i.routeId(),t).subscribe({next(){R(i,e=>k(E({},e),{schedule:e.schedule.filter(r=>r.rideId!==t)}))},error:e=>{o.displayError(e)}})}})));function Ve(i,n){if(i&1&&(a(0,"p"),p(1),d()),i&2){let o=n.$implicit;l(),$(o)}}function Me(i,n){if(i&1){let o=f();a(0,"div",17)(1,"div"),p(2),d(),a(3,"input",18,4),m("change",function(){let e=u(o).$implicit,r=C(4),s=c().$index,g=c(2);return _(g.onPriceChange(s,e,r.value))}),d()()}if(i&2){let o=n.$implicit;l(2),$(o)}}function $e(i,n){if(i&1){let o=f();a(0,"div",9)(1,"div",13)(2,"div"),p(3," Departure: "),a(4,"input",14,0),m("change",function(){let e=u(o).$index,r=C(5),s=c(2);return _(s.onDepartureDateChange(e,r.value))}),d(),a(6,"input",15,1),m("change",function(){let e=u(o).$index,r=C(7),s=c(2);return _(s.onDepartureTimeChange(e,r.value))}),d()(),a(8,"div"),p(9," Arrival: "),a(10,"input",14,2),m("change",function(){let e=u(o).$index,r=C(11),s=c(2);return _(s.onArrivalDateChange(e,r.value))}),d(),a(12,"input",15,3),m("change",function(){let e=u(o).$index,r=C(13),s=c(2);return _(s.onArrivalTimeChange(e,r.value))}),d()()(),a(14,"div",16),y(15,Me,5,1,"div",17,S),d()()}if(i&2){let o=c(2);l(15),T(o.carriageTypes())}}function Ee(i,n){if(i&1){let o=f();a(0,"div",5)(1,"h3"),p(2,"Create Ride"),d(),a(3,"div",6)(4,"div",7),y(5,Ve,2,1,"p",null,S),d(),a(7,"div",8),y(8,$e,17,0,"div",9,S),d()(),a(10,"div",10)(11,"button",11),m("click",function(){u(o);let e=c();return _(e.onCancelButtonClick())}),p(12," Cancel "),d(),a(13,"button",12),m("click",function(){u(o);let e=c();return _(e.onCreateButtonClick())}),p(14," Create "),d()()()}if(i&2){let o=c();l(5),T(o.stations()),l(3),T(o.rideSegments()),l(5),h("disabled",!o.areAllFieldsFilled())}}var ye=(()=>{let n=class n{constructor(){this.ridesStore=x(M),this.stations=V(()=>this.ridesStore.stations()),this.rideSegments=V(()=>this.ridesStore.stations()),this.carriageTypes=V(()=>this.ridesStore.carriages()),this.segmentsForSubmit=V(()=>this.rideSegments().map(()=>{let t={};return this.carriageTypes().forEach(e=>{t[e]=0}),{time:{departure:{date:"",time:"12:00"},arrival:{date:"",time:"12:00"}},price:t}})),this.formVisible=ne(!1)}onDepartureDateChange(t,e){this.segmentsForSubmit()[t].time.departure.date=e}onDepartureTimeChange(t,e){this.segmentsForSubmit()[t].time.departure.time=e}onArrivalDateChange(t,e){this.segmentsForSubmit()[t].time.arrival.date=e}onArrivalTimeChange(t,e){this.segmentsForSubmit()[t].time.arrival.time=e}onPriceChange(t,e,r){this.segmentsForSubmit()[t].price[e]=Number(r)}onCreateButtonClick(){this.formVisible.set(!1),this.ridesStore.createRide(this.ridesStore.routeId(),this.segmentsForSubmit())}areAllFieldsFilled(){return this.segmentsForSubmit().every(t=>t.time.departure.date&&t.time.departure.time&&t.time.arrival.date&&t.time.arrival.time)}onCancelButtonClick(){this.formVisible.set(!1)}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=w({type:n,selectors:[["app-ride-card-form"]],inputs:{formVisible:[1,"formVisible"]},outputs:{formVisible:"formVisibleChange"},standalone:!0,features:[F],decls:1,vars:1,consts:[["departureDate",""],["departureTime",""],["arrivalDate",""],["arrivalTime",""],["price",""],[1,"form-like"],[1,"container"],[1,"stations"],[1,"dates-and-prices"],[1,"row"],[1,"buttons"],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","",3,"click","disabled"],[1,"dates"],["type","date",3,"change"],["type","time",3,"change"],[1,"prices"],[1,"price"],["type","text",3,"change"]],template:function(e,r){e&1&&v(0,Ee,15,1,"div",5),e&2&&b(r.ridesStore.loading()?-1:0)},dependencies:[ue,q],styles:[".form-like[_ngcontent-%COMP%]{display:grid;row-gap:20px;padding:10px;border:1px solid gray;border-radius:5px;margin-bottom:50px}.container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;column-gap:10px}.stations[_ngcontent-%COMP%]{padding-left:5px;background-color:#fff4e2;display:flex;flex-direction:column;justify-content:space-between;border-radius:4px}.row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;column-gap:20px}.dates[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}.prices[_ngcontent-%COMP%]{padding-block:50px;display:grid;row-gap:5px}.price[_ngcontent-%COMP%]{display:flex;column-gap:10px}.buttons[_ngcontent-%COMP%]{justify-self:end;display:flex;column-gap:10px}"]});let i=n;return i})();function ke(i,n){if(i&1&&(a(0,"div",11),p(1),d()),i&2){let o=n.$implicit;l(),$(o)}}function De(i,n){if(i&1&&(p(0),Q(1,"date")),i&2){let o=c().$implicit;K(" ",o.time.departure.date," ",X(1,2,o.time.departure.date+"T"+o.time.departure.time,"hh:mm a")," ")}}function Pe(i,n){if(i&1){let o=f();a(0,"input",20,0),m("input",function(){u(o);let e=C(1),r=c().$index,s=c();return _(s.onDepartureDateInput(r,e.value))}),d(),a(2,"input",21,1),m("input",function(){u(o);let e=C(3),r=c().$index,s=c();return _(s.onDepartureTimeInput(r,e.value))}),d()}if(i&2){let o=c().$implicit;h("value",o.time.departure.date),l(2),h("value",o.time.departure.time)}}function Oe(i,n){if(i&1&&(p(0),Q(1,"date")),i&2){let o=c().$implicit;K(" ",o.time.arrival.date," ",X(1,2,o.time.arrival.date+"T"+o.time.arrival.time,"hh:mm a")," ")}}function Be(i,n){if(i&1){let o=f();a(0,"input",20,2),m("input",function(){u(o);let e=C(1),r=c().$index,s=c();return _(s.onArrivalDateInput(r,e.value))}),d(),a(2,"input",21,3),m("input",function(){u(o);let e=C(3),r=c().$index,s=c();return _(s.onArrivalTimeInput(r,e.value))}),d()}if(i&2){let o=c().$implicit;h("value",o.time.arrival.date),l(2),h("value",o.time.arrival.time)}}function je(i,n){if(i&1&&p(0),i&2){let o=c().$implicit;I(" $",o.value," ")}}function Ae(i,n){if(i&1){let o=f();a(0,"input",25,4),m("input",function(){u(o);let e=C(1),r=c(),s=r.$implicit,g=r.$index,G=c().$index,we=c();return _(we.onPriceInput(G,g,s.type,e.value))}),d()}if(i&2){let o=c().$implicit;h("value",o.value)}}function Le(i,n){if(i&1&&(a(0,"div",19)(1,"div",22),p(2),d(),a(3,"div",23),v(4,je,1,1)(5,Ae,2,1,"input",24),d()()),i&2){let o=n.$implicit;c();let t=B(0);l(2),$(o.type),l(2),b(t.price?5:4)}}function Ne(i,n){if(i&1){let o=f();de(0),a(1,"div",13)(2,"div",14)(3,"div",15)(4,"div"),p(5,"Departure:"),d(),a(6,"div"),v(7,De,2,5)(8,Pe,4,2),d(),a(9,"mat-icon",16),m("click",function(){let e=u(o).$index,r=B(0),s=c();return _(r.departure?s.onSave():s.toggleEditMode(e,"departure"))}),p(10),d()(),a(11,"div",15)(12,"div"),p(13,"Arrival:"),d(),a(14,"div"),v(15,Oe,2,5)(16,Be,4,2),d(),a(17,"mat-icon",16),m("click",function(){let e=u(o).$index,r=B(0),s=c();return _(r.arrival?s.onSave():s.toggleEditMode(e,"arrival"))}),p(18),d()()(),a(19,"div",17)(20,"div",18)(21,"span"),p(22,"Price"),d(),a(23,"mat-icon",16),m("click",function(){let e=u(o).$index,r=B(0),s=c();return _(r.price?s.onSave():s.toggleEditMode(e,"price"))}),p(24),d()(),y(25,Le,6,2,"div",19,S),d()()}if(i&2){let o=n.$index,t=n.$index,e=c(),r=se(e.editMode()[o]());l(7),b(r.departure?8:7),l(3),I(" ",r.departure?"save":"edit"," "),l(5),b(r.arrival?16:15),l(3),I(" ",r.arrival?"save":"edit"," "),l(6),I(" ",r.price?"save":"edit"," "),l(),T(e.prices()[t])}}var Te=(()=>{let n=class n{constructor(){this.ridesStore=x(M),this.rideId=L.required(),this.stations=L.required(),this.segments=L.required(),this.dialog=x(ge),this.prices=V(()=>this.segments().map(t=>Object.entries(t.price).map(([e,r])=>({type:e,value:r})))),this.editMode=V(()=>this.segments().map(()=>N({departure:!1,arrival:!1,price:!1})))}openDialog(){this.dialog.open(he,{data:{}}).afterClosed().subscribe(e=>{e&&this.ridesStore.deleteRide(this.rideId())})}toggleEditMode(t,e){this.editMode()[t].update(r=>k(E({},r),{[e]:!r[e]}))}onDepartureDateInput(t,e){this.segments()[t].time.departure.date=e}onDepartureTimeInput(t,e){this.segments()[t].time.departure.time=e}onArrivalDateInput(t,e){this.segments()[t].time.arrival.date=e}onArrivalTimeInput(t,e){this.segments()[t].time.arrival.time=e}onPriceInput(t,e,r,s){this.prices()[t][e].value=Number(s),this.segments()[t].price[r]=Number(s)}onSave(){this.editMode().forEach(t=>t.set({departure:!1,arrival:!1,price:!1})),this.ridesStore.updateRide(this.rideId())}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=w({type:n,selectors:[["app-ride-card"]],inputs:{rideId:[1,"rideId"],stations:[1,"stations"],segments:[1,"segments"]},standalone:!0,features:[F],decls:14,vars:1,consts:[["departureDate",""],["departureTime",""],["arrivalDate",""],["arrivalTime",""],["priceInput",""],[1,"card"],[1,"title-and-button"],[1,"title"],["mat-mini-fab","",3,"click"],[1,"content"],[1,"stations"],[1,"station"],[1,"dates-and-prices"],[1,"row"],[1,"dates"],[1,"date-and-icon"],["color","primary",1,"icon",3,"click"],[1,"prices"],[1,"price-and-icon"],[1,"price"],["type","date",3,"input","value"],["type","time",3,"input","value"],[1,"price-type"],[1,"price-value"],["type","text",3,"value"],["type","text",3,"input","value"]],template:function(e,r){e&1&&(a(0,"div",5)(1,"div",6)(2,"div",7),p(3),d(),a(4,"button",8),m("click",function(){return r.openDialog()}),a(5,"mat-icon"),p(6,"delete"),d()()(),a(7,"div",9)(8,"div",10),y(9,ke,2,1,"div",11,S),d(),a(11,"div",12),y(12,Ne,27,6,"div",13,S),d()()()),e&2&&(l(3),I("Ride ",r.rideId(),""),l(6),T(r.stations()),l(3),T(r.segments()))},dependencies:[ce,U,W],styles:[".card[_ngcontent-%COMP%]{padding:10px;border:1px solid gray;border-radius:5px}.title-and-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid gray;margin-bottom:20px;padding-block:10px}.title[_ngcontent-%COMP%]{font-size:28px}.content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;column-gap:10px}.stations[_ngcontent-%COMP%]{padding-left:5px;background-color:#fff4e2;display:flex;flex-direction:column;justify-content:space-between;border-radius:4px}.row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;column-gap:20px}.dates[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}.prices[_ngcontent-%COMP%]{padding-block:50px}.price[_ngcontent-%COMP%]{display:flex;column-gap:10px}.date-and-icon[_ngcontent-%COMP%]{display:grid;grid-template-columns:max-content max-content 1fr;align-items:center;column-gap:10px}.price-and-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.icon[_ngcontent-%COMP%]{justify-self:end}.icon[_ngcontent-%COMP%]:hover{cursor:pointer}"]});let i=n;return i})();function qe(i,n){i&1&&O(0,"mat-progress-spinner",1)}function Ue(i,n){if(i&1&&O(0,"app-ride-card",2),i&2){let o=n.$implicit,t=c(2);h("rideId",o.rideId)("stations",t.store.stations())("segments",o.segments)}}function We(i,n){if(i&1&&y(0,Ue,1,3,"app-ride-card",2,S),i&2){let o=c();T(o.store.schedule())}}var Re=(()=>{let n=class n{constructor(){this.store=x(M)}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=w({type:n,selectors:[["app-ride-list"]],standalone:!0,features:[F],decls:3,vars:1,consts:[[1,"list"],["mode","indeterminate",1,"spinner"],[3,"rideId","stations","segments"]],template:function(e,r){e&1&&(a(0,"div",0),v(1,qe,1,0,"mat-progress-spinner",1)(2,We,2,0),d()),e&2&&(l(),b(r.store.loading()?1:2))},dependencies:[Te,ve],styles:[".list[_ngcontent-%COMP%]{display:grid;row-gap:40px}.spinner[_ngcontent-%COMP%]{place-self:center}"]});let i=n;return i})();function ze(i,n){if(i&1){let o=f();a(0,"button",6),m("click",function(){u(o);let e=c();return _(e.showForm())}),p(1," Create Ride "),d()}}function He(i,n){if(i&1){let o=f();a(0,"app-ride-card-form",7),ae("formVisibleChange",function(e){u(o);let r=c();return oe(r.formVisible,e)||(r.formVisible=e),_(e)}),d()}if(i&2){let o=c();re("formVisible",o.formVisible)}}var Lt=(()=>{let n=class n{constructor(t,e){this.router=t,this.activatedRoute=e,this.routeId=null,this.stationsStore=x(z),this.ridesStore=x(M),this.formVisible=N(!1)}async ngOnInit(){let t=this.activatedRoute.snapshot.paramMap.get("id");if(!t||Number.isNaN(Number(t))){this.router.navigate([j.Admin,j.AdminRoutes]);return}this.routeId=Number(t),await this.stationsStore.getStations(),this.ridesStore.prepareStore(this.routeId)}onBackButtonClick(){this.router.navigate([j.Admin,j.AdminRoutes])}showForm(){this.formVisible.set(!0)}};n.\u0275fac=function(e){return new(e||n)(J(me),J(pe))},n.\u0275cmp=w({type:n,selectors:[["app-rides"]],standalone:!0,features:[F],decls:10,vars:2,consts:[[1,"layout"],[1,"title-and-button"],["mat-mini-fab","",1,"btn",3,"click"],[1,"title"],["mat-flat-button","",1,"btn","btn-create-ride"],[3,"formVisible"],["mat-flat-button","",1,"btn","btn-create-ride",3,"click"],[3,"formVisibleChange","formVisible"]],template:function(e,r){e&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),m("click",function(){return r.onBackButtonClick()}),a(3,"mat-icon"),p(4,"arrow_back"),d()(),a(5,"h3",3),p(6),d()(),v(7,ze,2,0,"button",4)(8,He,1,1,"app-ride-card-form",5),O(9,"app-ride-list"),d()),e&2&&(l(6),I("Route ",r.routeId,""),l(),b(r.formVisible()?8:7))},dependencies:[q,U,W,Re,ye],styles:[".layout[_ngcontent-%COMP%]{max-width:1200px;margin-inline:auto;padding:20px}.title-and-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;margin-bottom:50px}.title[_ngcontent-%COMP%]{margin:0}.btn-create-ride[_ngcontent-%COMP%]{margin-bottom:20px}.btn[_ngcontent-%COMP%]{border-radius:4px}"]});let i=n;return i})();export{Lt as RidesComponent};
